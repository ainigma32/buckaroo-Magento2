<?xml version="1.0" encoding="UTF-8"?>
<!--
/**
 * NOTICE OF LICENSE
 *
 * This source file is subject to the MIT License
 * It is available through the world-wide-web at this URL:
 * https://tldrlegal.com/license/mit-license
 * If you are unable to obtain it through the world-wide-web, please send an email
 * to support@buckaroo.nl so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this module to newer
 * versions in the future. If you wish to customize this module for your
 * needs please contact support@buckaroo.nl for more information.
 *
 * @copyright Copyright (c) Buckaroo B.V.
 * @license   https://tldrlegal.com/license/mit-license
 */
 -->
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <preference for="Magento\Payment\Gateway\Data\Order\OrderAdapter" type="Buckaroo\Magento2\Gateway\Data\Order\OrderAdapter"/>
    <preference for="Buckaroo\Magento2\Gateway\GatewayInterface" type="Buckaroo\Magento2\Gateway\Http\Bpe3"/>
    <preference for="Buckaroo\Magento2\Api\CertificateRepositoryInterface" type="Buckaroo\Magento2\Model\CertificateRepository"/>
    <preference for="Buckaroo\Magento2\Api\InvoiceRepositoryInterface" type="Buckaroo\Magento2\Model\InvoiceRepository"/>
    <preference for="Buckaroo\Magento2\Api\GiftcardRepositoryInterface" type="Buckaroo\Magento2\Model\GiftcardRepository"/>
    <preference for="Buckaroo\Magento2\Api\GroupTransactionRepositoryInterface" type="Buckaroo\Magento2\Model\GroupTransactionRepository"/>
    <preference for="Buckaroo\Magento2\Api\PushInterface" type="Buckaroo\Magento2\Model\Push"/>
    <preference for="Buckaroo\Magento2\Api\PaymentInformationManagementInterface" type="Buckaroo\Magento2\Model\PaymentInformationManagement"/>
    <preference for="Buckaroo\Magento2\Api\GuestPaymentInformationManagementInterface" type="Buckaroo\Magento2\Model\GuestPaymentInformationManagement"/>
    <preference for="Magento\Quote\Model\Cart\CartTotalRepository" type="Buckaroo\Magento2\Model\Cart\CartTotalRepository" />
    <preference for="Magento\Sales\Model\ResourceModel\Order\Handler\State" type="Buckaroo\Magento2\Model\ResourceModel\Order\Handler\State" />
    <preference for="Onestepcheckout\Iosc\Plugin\GuestSaveManager" type="Buckaroo\Magento2\Plugin\GuestSaveManager" />
    <preference for="Magento\Payment\Model\Checks\CanUseForCountry\CountryProvider" type="Buckaroo\Magento2\Model\Checks\CanUseForCountry\CountryProvider" />
    <preference for="Mageplaza\Osc\Model\CheckoutManagement" type="Buckaroo\Magento2\Plugin\CheckoutManagement" />
    <preference for="Magento\Ui\Model\Export\ConvertToCsv" type="Buckaroo\Magento2\Model\Export\ConvertToCsv" />
    <preference for="Magento\Sales\Model\Order\CreditmemoFactory" type="Buckaroo\Magento2\Model\Order\CreditmemoFactory" />

    <!-- giftcard rest api -->
    <preference for="Buckaroo\Magento2\Api\PayWithGiftcardInterface" type="Buckaroo\Magento2\Model\Giftcard\Api\Pay"/>
    <preference for="Buckaroo\Magento2\Model\Giftcard\Request\GiftcardInterface" type="Buckaroo\Magento2\Model\Giftcard\Request\Giftcard"/>
    <preference for="Buckaroo\Magento2\Api\Data\Giftcard\PayResponseSetInterface" type="Buckaroo\Magento2\Model\Giftcard\Api\PayResponse"/>

    <preference for="Buckaroo\Magento2\Api\Data\Giftcard\TransactionResponseInterface" type="Buckaroo\Magento2\Model\Giftcard\Api\TransactionResponse"/>
    <preference for="Buckaroo\Magento2\Api\Data\Giftcard\GetTransactionsResponseInterface" type="Buckaroo\Magento2\Model\Giftcard\Api\GetTransactionsResponse"/>
    <preference for="Buckaroo\Magento2\Api\Data\Giftcard\PayRequestInterface" type="Buckaroo\Magento2\Model\Giftcard\Api\PayRequest"/>
    <preference for="Buckaroo\Magento2\Api\GiftcardTransactionInterface" type="Buckaroo\Magento2\Model\Giftcard\Api\GetTransactions"/>
    <!-- end gifcard rest api -->

    <!-- paypal-express -->
    <preference for="Buckaroo\Magento2\Model\PaypalExpress\QuoteBuilderInterface" type="Buckaroo\Magento2\Model\PaypalExpress\QuoteBuilder" />

    <preference for="Buckaroo\Magento2\Api\PaypalExpressQuoteCreateInterface" type="Buckaroo\Magento2\Model\PaypalExpress\QuoteCreate" />

    <preference for="Buckaroo\Magento2\Api\Data\PaypalExpress\QuoteCreateResponseInterface" type="Buckaroo\Magento2\Model\PaypalExpress\Response\QuoteCreate" />
    <preference for="Buckaroo\Magento2\Api\Data\PaypalExpress\TotalBreakdownInterface" type="Buckaroo\Magento2\Model\PaypalExpress\Response\TotalBreakdown" />
    <preference for="Buckaroo\Magento2\Api\Data\PaypalExpress\BreakdownItemInterface" type="Buckaroo\Magento2\Model\PaypalExpress\Response\BreakdownItem" />

    <preference for="Buckaroo\Magento2\Api\Data\PaypalExpress\OrderDataItemInterface" type="Buckaroo\Magento2\Model\PaypalExpress\Request\OrderDataItem" />
    <preference for="Buckaroo\Magento2\Api\Data\PaypalExpress\ShippingAddressRequestInterface" type="Buckaroo\Magento2\Model\PaypalExpress\Request\ShippingAddress" />

    <preference for="Buckaroo\Magento2\Api\PaypalExpressOrderCreateInterface" type="Buckaroo\Magento2\Model\PaypalExpress\OrderCreate" />

    <preference for="Buckaroo\Magento2\Api\Data\PaypalExpress\OrderCreateResponseInterface" type="Buckaroo\Magento2\Model\PaypalExpress\Response\OrderCreate" />
    <!-- end paypal-express -->

    <type name="Buckaroo\Magento2\Model\Method\AbstractMethod">
        <arguments>
            <argument name="gateway" xsi:type="object">Buckaroo\Magento2\Gateway\GatewayInterface</argument>
            <argument name="transactionBuilderFactory" xsi:type="object">Buckaroo\Magento2\Gateway\Http\TransactionBuilderFactory</argument>
            <argument name="validatorFactory" xsi:type="object">Buckaroo\Magento2\Model\ValidatorFactory</argument>
            <argument name="messageManager" xsi:type="object">Magento\Framework\Message\ManagerInterface</argument>
            <argument name="helper" xsi:type="object">Buckaroo\Magento2\Helper\Data</argument>
            <argument name="request" xsi:type="object">Magento\Framework\App\RequestInterface</argument>
            <argument name="refundFieldsFactory" xsi:type="object">Buckaroo\Magento2\Model\RefundFieldsFactory</argument>
            <argument name="configProviderFactory" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Factory</argument>
            <argument name="configProviderMethodFactory" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Factory</argument>
            <argument name="priceHelper" xsi:type="object">Magento\Framework\Pricing\Helper\Data</argument>
            <argument name="quoteFactory" xsi:type="object">Magento\Quote\Model\QuoteFactory</argument>
            <argument name="logger2" xsi:type="object">Buckaroo\Magento2\Logging\Log</argument>
        </arguments>
    </type>
    <type name="Magento\Checkout\Controller\Onepage\Success">
        <plugin name="buckaroo_magento2_checkout_success" type="Buckaroo\Magento2\Plugin\Onepage\Success" />
    </type>
    <type name="Buckaroo\Magento2\Model\Method\Paypal">
        <plugin name="buckaroo_magento2_paypal_sellersprotection_order" type="Buckaroo\Magento2\Model\Service\Plugin\PaypalSellersProtection\Order" />
    </type>

    <type name="Buckaroo\Magento2\Model\Method\SepaDirectDebit">
        <plugin name="buckaroo_magento2_sepadirectdebit" type="Buckaroo\Magento2\Plugin\Method\SepaDirectDebit" />
    </type>

    <type name="Magento\Sales\Api\OrderRepositoryInterface">
        <plugin name="buckaroo_magento2_add_order_extension_attributes" type="Buckaroo\Magento2\Plugin\OrderExtensionAttribute" />
    </type>

    <type name="Magento\Sales\Api\CreditmemoRepositoryInterface">
        <plugin name="buckaroo_magento2_add_creditmemo_extension_attributes" type="Buckaroo\Magento2\Plugin\CreditmemoExtensionAttribute" />
    </type>

    <type name="Magento\Sales\Model\Order">
        <plugin name="buckaroo_magento2_plugin_afterpay" type="Buckaroo\Magento2\Plugin\Method\Afterpay"/>
        <plugin name="buckaroo_magento2_plugin_afterpay2" type="Buckaroo\Magento2\Plugin\Method\Afterpay2"/>
        <plugin name="buckaroo_magento2_plugin_emandate" type="Buckaroo\Magento2\Plugin\Method\Emandate"/>
        <plugin name="buckaroo_magento2_plugin_klarna" type="Buckaroo\Magento2\Plugin\Method\Klarna"/>
        <plugin name="buckaroo_magento2_plugin_klarnakp" type="Buckaroo\Magento2\Plugin\Method\Klarnakp"/>
        <plugin name="buckaroo_magento2_plugin_klarnain" type="Buckaroo\Magento2\Plugin\Method\Klarnain"/>
    </type>

    <type name="Buckaroo\Magento2\Model\Push">
        <plugin name="buckaroo_magento2_paypal_sellersprotection_push" type="Buckaroo\Magento2\Model\Service\Plugin\PaypalSellersProtection\Push" />
        <plugin name="buckaroo_magento2_mpi_push" type="Buckaroo\Magento2\Model\Service\Plugin\Mpi\Push" />
        <arguments>
            <argument name="fileSystemDriver" xsi:type="object">Magento\Framework\Filesystem\Driver\File</argument>
        </arguments>
    </type>

    <type name="Magento\Sales\Model\Order\Payment\State\OrderCommand">
        <plugin name="buckaroo_magento2_plugin_commandInterface" type="Buckaroo\Magento2\Plugin\CommandInterface" />
    </type>

    <type name="Magento\Sales\Model\Order\Payment\State\AuthorizeCommand">
        <plugin name="buckaroo_magento2_plugin_commandInterface" type="Buckaroo\Magento2\Plugin\CommandInterface" />
    </type>

    <type name="Buckaroo\Magento2\Model\PaymentInformationManagement">
        <arguments>
            <argument name="registry" xsi:type="object">Magento\Framework\Registry</argument>
        </arguments>
    </type>

    <type name="Buckaroo\Magento2\Model\GuestPaymentInformationManagement">
        <arguments>
            <argument name="registry" xsi:type="object">Magento\Framework\Registry</argument>
        </arguments>
    </type>

    <type name="Buckaroo\Magento2\Model\ValidatorFactory">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="push" xsi:type="array">
                    <item name="type" xsi:type="string">push</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\Validator\Push</item>
                </item>
                <item name="transaction_response" xsi:type="array">
                    <item name="type" xsi:type="string">transaction_response</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\Validator\TransactionResponse</item>
                </item>
                <item name="transaction_response_status" xsi:type="array">
                    <item name="type" xsi:type="string">transaction_response_status</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\Validator\TransactionResponseStatus</item>
                </item>
                <item name="redirect_process" xsi:type="array">
                    <item name="type" xsi:type="string">redirect_return</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\Validator\RedirectProcess</item>
                </item>
                <item name="amount" xsi:type="array">
                    <item name="type" xsi:type="string">amount</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\Validator\Amount</item>
                </item>
            </argument>
        </arguments>
    </type>

    <type name="Buckaroo\Magento2\Model\Validator\TransactionResponse">
        <arguments>
            <argument name="publicKeyConfigProvider" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\PublicKey</argument>
        </arguments>
    </type>

    <type name="Buckaroo\Magento2\Model\Validator\TransactionResponseStatus">
        <arguments>
            <argument name="helper" xsi:type="object">Buckaroo\Magento2\Helper\Data</argument>
        </arguments>
    </type>

    <type name="Buckaroo\Magento2\Model\ResourceModel\Certificate">
        <arguments>
            <argument name="dateTime" xsi:type="object">Magento\Framework\Stdlib\DateTime\DateTime</argument>
        </arguments>
    </type>

    <type name="Buckaroo\Magento2\Gateway\Http\TransactionBuilderFactory">
        <arguments>
            <argument name="transactionBuilders" xsi:type="array">
                <item name="order" xsi:type="array">
                    <item name="type" xsi:type="string">order</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Gateway\Http\TransactionBuilder\Order</item>
                </item>
                <item name="refund" xsi:type="array">
                    <item name="type" xsi:type="string">refund</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Gateway\Http\TransactionBuilder\Refund</item>
                </item>
                <item name="cancel" xsi:type="array">
                    <item name="type" xsi:type="string">cancel</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Gateway\Http\TransactionBuilder\Cancel</item>
                </item>
                <item name="datarequest" xsi:type="array">
                    <item name="type" xsi:type="string">datarequest</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Gateway\Http\TransactionBuilder\DataRequest</item>
                </item>
                <item name="idin" xsi:type="array">
                    <item name="type" xsi:type="string">idin</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Gateway\Http\TransactionBuilder\Idin</item>
                </item>
            </argument>
        </arguments>
    </type>

    <type name="Buckaroo\Magento2\Model\ConfigProvider\Method\Factory">
        <arguments>
            <argument name="configProviders" xsi:type="array">
                <item name="ideal" xsi:type="array">
                    <item name="type" xsi:type="string">ideal</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Ideal</item>
                </item>
                <item name="idealgateway" xsi:type="array">
                    <item name="type" xsi:type="string">idealgateway</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\IdealGateway</item>
                </item>
                <item name="idealprocessing" xsi:type="array">
                    <item name="type" xsi:type="string">idealprocessing</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\IdealProcessing</item>
                </item>
                <item name="creditcard" xsi:type="array">
                    <item name="type" xsi:type="string">creditcard</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Creditcard</item>
                </item>
                <item name="creditcards" xsi:type="array">
                    <item name="type" xsi:type="string">creditcards</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Creditcards</item>
                </item>
                <item name="giropay" xsi:type="array">
                    <item name="type" xsi:type="string">giropay</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Giropay</item>
                </item>
                <item name="mrcash" xsi:type="array">
                    <item name="type" xsi:type="string">mrcash</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Mrcash</item>
                </item>
                <item name="paypal" xsi:type="array">
                    <item name="type" xsi:type="string">paypal</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Paypal</item>
                </item>
                <item name="payconiq" xsi:type="array">
                    <item name="type" xsi:type="string">payconiq</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Payconiq</item>
                </item>
                <item name="sepadirectdebit" xsi:type="array">
                    <item name="type" xsi:type="string">sepadirectdebit</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\SepaDirectDebit</item>
                </item>
                <item name="sofortbanking" xsi:type="array">
                    <item name="type" xsi:type="string">sofortbanking</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Sofortbanking</item>
                </item>
                <item name="belfius" xsi:type="array">
                    <item name="type" xsi:type="string">belfius</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Belfius</item>
                </item>
                <item name="transfer" xsi:type="array">
                    <item name="type" xsi:type="string">transfer</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Transfer</item>
                </item>
                <item name="afterpay" xsi:type="array">
                    <item name="type" xsi:type="string">afterpay</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Afterpay</item>
				</item>
                <item name="afterpay2" xsi:type="array">
                    <item name="type" xsi:type="string">afterpay2</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Afterpay2</item>
				</item>
                <item name="afterpay20" xsi:type="array">
                    <item name="type" xsi:type="string">afterpay20</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Afterpay20</item>
                </item>
                <item name="billink" xsi:type="array">
                    <item name="type" xsi:type="string">billink</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Billink</item>
                </item>
                <item name="payperemail" xsi:type="array">
                    <item name="type" xsi:type="string">payperemail</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\PayPerEmail</item>
                </item>
                <item name="paylink" xsi:type="array">
                    <item name="type" xsi:type="string">paylink</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\PayLink</item>
                </item>
                <item name="eps" xsi:type="array">
                    <item name="type" xsi:type="string">eps</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Eps</item>
                </item>
                <item name="giftcards" xsi:type="array">
                    <item name="type" xsi:type="string">giftcards</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Giftcards</item>
                </item>
                <item name="kbc" xsi:type="array">
                    <item name="type" xsi:type="string">kbc</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Kbc</item>
                </item>
                <item name="klarna" xsi:type="array">
                    <item name="type" xsi:type="string">klarna</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Klarna</item>
                </item>
                <item name="klarnakp" xsi:type="array">
                    <item name="type" xsi:type="string">klarnakp</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Klarnakp</item>
                </item>
                <item name="klarnain" xsi:type="array">
                    <item name="type" xsi:type="string">klarnain</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Klarnain</item>
                </item>
                <item name="emandate" xsi:type="array">
                    <item name="type" xsi:type="string">emandate</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Emandate</item>
                </item>
                <item name="applepay" xsi:type="array">
                    <item name="type" xsi:type="string">applepay</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Applepay</item>
                </item>
                <item name="capayablein3" xsi:type="array">
                    <item name="type" xsi:type="string">capayablein3</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\CapayableIn3</item>
                </item>
                <item name="capayablepostpay" xsi:type="array">
                    <item name="type" xsi:type="string">capayablepostpay</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\CapayablePostpay</item>
                </item>
                <item name="alipay" xsi:type="array">
                    <item name="type" xsi:type="string">alipay</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Alipay</item>
                </item>
                <item name="wechatpay" xsi:type="array">
                    <item name="type" xsi:type="string">wechatpay</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Wechatpay</item>
                </item>
                <item name="p24" xsi:type="array">
                    <item name="type" xsi:type="string">p24</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\P24</item>
                </item>
                <item name="trustly" xsi:type="array">
                    <item name="type" xsi:type="string">trustly</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Trustly</item>
                </item>
                <item name="rtp" xsi:type="array">
                    <item name="type" xsi:type="string">rtp</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Rtp</item>
                </item>
                <item name="pospayment" xsi:type="array">
                    <item name="type" xsi:type="string">pospayment</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Pospayment</item>
                </item>
                <item name="tinka" xsi:type="array">
                    <item name="type" xsi:type="string">tinka</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Method\Tinka</item>
                </item>
            </argument>
        </arguments>
    </type>

    <type name="Buckaroo\Magento2\Model\ConfigProvider\Factory">
        <arguments>
            <argument name="configProviders" xsi:type="array">
                <item name="account" xsi:type="array">
                    <item name="type" xsi:type="string">account</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Account</item>
                </item>
                <item name="private_key" xsi:type="array">
                    <item name="type" xsi:type="string">private_key</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\PrivateKey</item>
                </item>
                <item name="public_key" xsi:type="array">
                    <item name="type" xsi:type="string">public_key</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\PublicKey</item>
                </item>
                <item name="predefined" xsi:type="array">
                    <item name="type" xsi:type="string">predefined</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Predefined</item>
                </item>
                <item name="states" xsi:type="array">
                    <item name="type" xsi:type="string">states</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\States</item>
                </item>
                <item name="buckaroo_fee" xsi:type="array">
                    <item name="type" xsi:type="string">buckaroo_fee</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\BuckarooFee</item>
                </item>
                <item name="allowed_currencies" xsi:type="array">
                    <item name="type" xsi:type="string">allowed_currencies</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\AllowedCurrencies</item>
                </item>
                <item name="refund" xsi:type="array">
                    <item name="type" xsi:type="string">refund</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Model\ConfigProvider\Refund</item>
                </item>
            </argument>
        </arguments>
    </type>

    <type name="Buckaroo\Magento2\Logging\InternalLogger">
        <arguments>
            <argument name="name" xsi:type="string">buckaroo_logging</argument>
            <argument name="handlers"  xsi:type="array">
                <item name="exception" xsi:type="object">Buckaroo\Magento2\Logging\CriticalHandler</item>
                <item name="debug" xsi:type="object">Buckaroo\Magento2\Logging\DebugHandler</item>
            </argument>
        </arguments>
    </type>

    <type name="Buckaroo\Magento2\Block\Adminhtml\Sales\Order\Creditmemo\Create\BankFields">
        <arguments>
            <argument name="refundFieldsFactory" xsi:type="object">Buckaroo\Magento2\Model\RefundFieldsFactory</argument>
        </arguments>
    </type>

    <type name="Magento\Framework\Webapi\Rest\Request\DeserializerFactory">
        <arguments>
            <argument name="deserializers" xsi:type="array">
                <item name="application_x-www-form-urlencoded" xsi:type="array">
                    <item name="type" xsi:type="string">application/x-www-form-urlencoded</item>
                    <item name="model" xsi:type="string">Buckaroo\Magento2\Webapi\Rest\Request\Deserializer\XWwwFormUrlencoded</item>
                </item>
                <item name="application_json" xsi:type="array">
                    <item name="type" xsi:type="string">application/json</item>
                    <item name="model" xsi:type="string">Magento\Framework\Webapi\Rest\Request\Deserializer\Json</item>
                </item>
                <item name="application_xml" xsi:type="array">
                    <item name="type" xsi:type="string">application/xml</item>
                    <item name="model" xsi:type="string">Magento\Framework\Webapi\Rest\Request\Deserializer\Xml</item>
                </item>
                <item name="application_xhtml_xml" xsi:type="array">
                    <item name="type" xsi:type="string">application/xhtml+xml</item>
                    <item name="model" xsi:type="string">Magento\Framework\Webapi\Rest\Request\Deserializer\Xml</item>
                </item>
                <item name="text_xml" xsi:type="array">
                    <item name="type" xsi:type="string">text/xml</item>
                    <item name="model" xsi:type="string">Magento\Framework\Webapi\Rest\Request\Deserializer\Xml</item>
                </item>
            </argument>
        </arguments>
    </type>

    <type name="Buckaroo\Magento2\Model\RefundFieldsFactory">
    </type>

    <type name="Magento\Quote\Model\Cart\CartTotalRepository">
        <plugin name="buckaroo_magento2_fee_total" type="Buckaroo\Magento2\Plugin\CartTotalRepository" />
    </type>

    <type name="Magento\Quote\Model\Quote\TotalsCollector">
        <plugin name="buckaroo_magento2_fee_total_collector" type="Buckaroo\Magento2\Plugin\TotalsCollector" />
    </type>

    <type name="Magento\Quote\Model\Cart\TotalsConverter">
        <plugin name="buckaroo_magento2_fee_total_converter" type="Buckaroo\Magento2\Plugin\TotalsConverter" />
    </type>

    <type name="Buckaroo\Magento2\Block\Info\Creditcard">
        <arguments>
            <argument name="configProvider" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Creditcard</argument>
        </arguments>
    </type>

    <type name="Buckaroo\Magento2\Model\ConfigProvider\CompositeConfigProvider">
        <arguments>
            <argument name="configProviders" xsi:type="array">
                <item name="buckaroo_magento2_configprovider_account" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Account</item>
                <item name="buckaroo_magento2_configprovider_buckaroofee" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\BuckarooFee</item>
                <item name="buckaroo_magento2_configprovider_predefined" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Predefined</item>
                <item name="buckaroo_magento2_configprovider_privatekey" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Privatekey</item>
                <item name="buckaroo_magento2_configprovider_publickey" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Publickey</item>
                <item name="buckaroo_magento2_configprovider_refund" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Refund</item>
                <item name="buckaroo_magento2_configprovider_states" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\States</item>
            </argument>
        </arguments>
    </type>

    <type name="Buckaroo\Magento2\Gateway\Http\TransactionBuilder\AbstractTransactionBuilder">
        <arguments>
            <argument name="urlBuilder" xsi:type="object">Magento\Framework\Url</argument>
        </arguments>
    </type>

    <type name="Magento\Framework\View\Asset\Minification">
        <plugin name="my-exclude" type="Buckaroo\Magento2\Plugin\ExcludeFilesFromMinification" />
    </type>

    <type name="MyParcelNL\Magento\Model\Checkout\ShippingMethods">
        <plugin name="myParcelNLBuckarooPlugin" type="Buckaroo\Magento2\Plugin\MyParcelNLBuckarooPlugin" />
    </type>

    <type name="Magento\CatalogInventory\Model\Configuration">
        <plugin name="buckarooCatalogInventoryConfiguration" type="Buckaroo\Magento2\Plugin\CatalogInventory\Model\Configuration" />
    </type>

    <type name="Magento\Checkout\Api\PaymentInformationManagementInterface">
        <plugin name="buckarooPaymentInformationManagement" type="Buckaroo\Magento2\Plugin\PaymentMethodManagement"/>
    </type>

    <type name="Magento\Checkout\Api\GuestPaymentInformationManagementInterface">
        <plugin name="buckarooGuestPaymentInformationManagement" type="Buckaroo\Magento2\Plugin\GuestPaymentMethodManagement"/>
    </type>

    <type name="Magento\Framework\Console\CommandListInterface">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="buckaroo_pushsend" xsi:type="object">Buckaroo\Magento2\Console\Command\PushSend\Proxy</item>
            </argument>
        </arguments>
    </type>

    <!-- Buckaroo Payment Provider Gateway -->
    <type name="Buckaroo\Magento2\Model\Adapter\BuckarooAdapter">
        <arguments>
            <argument name="mapPaymentMethods" xsi:type="array">
                <item name="klaranain" xsi:type="string">klarna</item>
                <item name="p24" xsi:type="string">przelewy24</item>
                <item name="kbc" xsi:type="string">kbcpaymentbutton</item>
                <item name="Capayable" xsi:type="string">in3</item>
            </argument>
        </arguments>
    </type>

    <virtualType name="AdditionalParametersOrderDataBuilder" type="Buckaroo\Magento2\Gateway\Request\AdditionalParametersDataBuilder">
        <arguments>
            <argument name="action" xsi:type="string">order</argument>
        </arguments>
    </virtualType>

    <virtualType name="AdditionalParametersRefundDataBuilder" type="Buckaroo\Magento2\Gateway\Request\AdditionalParametersDataBuilder">
        <arguments>
            <argument name="action" xsi:type="string">refund</argument>
        </arguments>
    </virtualType>

    <virtualType name="AdditionalParametersPayDataBuilder" type="Buckaroo\Magento2\Gateway\Request\AdditionalParametersDataBuilder">
        <arguments>
            <argument name="action" xsi:type="string">pay</argument>
        </arguments>
    </virtualType>

    <virtualType name="AdditionalParametersPayInInstallmentsDataBuilder" type="Buckaroo\Magento2\Gateway\Request\AdditionalParametersDataBuilder">
        <arguments>
            <argument name="action" xsi:type="string">payininstallments</argument>
        </arguments>
    </virtualType>

    <virtualType name="AdditionalParametersReserveDataBuilder" type="Buckaroo\Magento2\Gateway\Request\AdditionalParametersDataBuilder">
        <arguments>
            <argument name="action" xsi:type="string">reserve</argument>
        </arguments>
    </virtualType>

    <!-- Buckaroo AddressHandlerPool - Change Shipping Request by Delivery Methods-->
    <type name="Buckaroo\Magento2\Gateway\Request\AddressHandlerPool">
        <arguments>
            <argument name="addressHandlers" xsi:type="array">
                <item name="postnl_postnl" xsi:type="object">Buckaroo\Magento2\Gateway\Request\AddressHandler\PostNLAddressHandler</item>
                <item name="dpdpickup_dpdpickup" xsi:type="object">Buckaroo\Magento2\Gateway\Request\AddressHandler\DPDPickupAddressHandler</item>
                <item name="dhlparcel_servicepoint" xsi:type="object">Buckaroo\Magento2\Gateway\Request\AddressHandler\DHLParcelAddressHandler</item>
                <item name="sendcloud_sendcloud" xsi:type="object">Buckaroo\Magento2\Gateway\Request\AddressHandler\SendCloudAddressHandler</item>
                <item name="myparcel_myparcel" xsi:type="object">Buckaroo\Magento2\Gateway\Request\AddressHandler\MyParcelAddressHandler</item>
            </argument>
        </arguments>
    </type>

    <!-- Buckaroo Commands infrastructure -->
    <virtualType name="BuckarooGatewayCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="order" xsi:type="string">BuckarooOrderCommand</item>
                <item name="refund" xsi:type="string">BuckarooRefundCommand</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Buckaroo Order Command -->
    <virtualType name="BuckarooOrderCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">BuckarooOrderRequest</argument>
            <argument name="transferFactory" xsi:type="object">Buckaroo\Magento2\Gateway\Http\SDKTransferFactory</argument>
            <argument name="client" xsi:type="object">Buckaroo\Magento2\Gateway\Http\Client\TransactionPay</argument>
            <argument name="handler" xsi:type="object">OrderResponseHandler</argument>
            <argument name="validator" xsi:type="object">Buckaroo\Magento2\Gateway\Validator\ResponseCodeSDKValidator</argument>
            <argument name="errorMessageMapper" xsi:type="object">Buckaroo\Magento2\Gateway\ErrorMapper\VirtualErrorMessageMapper</argument>
        </arguments>
    </virtualType>

    <!-- Buckaroo Order Command - Request Builder -->
    <virtualType name="BuckarooOrderRequest" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="method" xsi:type="string">Buckaroo\Magento2\Gateway\Request\PaymentMethodDataBuilder</item>
                <item name="amount_debit" xsi:type="string">Buckaroo\Magento2\Gateway\Request\AmountDebitDataBuilder</item>
                <item name="invoice" xsi:type="string">Buckaroo\Magento2\Gateway\Request\InvoiceDataBuilder</item>
                <item name="description" xsi:type="string">Buckaroo\Magento2\Gateway\Request\DescriptionDataBuilder</item>
                <item name="client_ip" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ClientIPDataBuilder</item>
                <item name="return_url" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ReturnUrlDataBuilder</item>
                <item name="additional_parameters" xsi:type="string">AdditionalParametersPayDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Buckaroo Order Command - Response Handler -->
    <virtualType name="OrderResponseHandler"  type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="response" xsi:type="string">Buckaroo\Magento2\Gateway\Response\OrderHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- END Buckaroo Order Command -->

    <!-- Buckaroo Authorize Command - Response Handler -->
    <virtualType name="AuthorizeResponseHandler"  type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="response" xsi:type="string">Buckaroo\Magento2\Gateway\Response\AuthorizeHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Buckaroo Refund Command -->
    <virtualType name="BuckarooRefundCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">BuckarooRefundRequest</argument>
            <argument name="transferFactory" xsi:type="object">Buckaroo\Magento2\Gateway\Http\SDKTransferFactory</argument>
            <argument name="client" xsi:type="object">Buckaroo\Magento2\Gateway\Http\Client\TransactionRefund</argument>
            <argument name="handler" xsi:type="object">RefundResponseHandler</argument>
            <argument name="validator" xsi:type="object">Buckaroo\Magento2\Gateway\Validator\ResponseCodeSDKValidator</argument>
            <argument name="errorMessageMapper" xsi:type="object">Buckaroo\Magento2\Gateway\ErrorMapper\VirtualErrorMessageMapper</argument>
        </arguments>
    </virtualType>
    <!-- Buckaroo Refund Command - Request Builder -->
    <virtualType name="BuckarooRefundRequest" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="method" xsi:type="string">Buckaroo\Magento2\Gateway\Request\PaymentMethodDataBuilder</item>
                <item name="invoice" xsi:type="string">Buckaroo\Magento2\Gateway\Request\InvoiceDataBuilder</item>
                <item name="original_transaction_key" xsi:type="string">Buckaroo\Magento2\Gateway\Request\OriginalTransactionKeyDataBuilder</item>
                <item name="amount_credit" xsi:type="string">Buckaroo\Magento2\Gateway\Request\AmountCreditDataBuilder</item>
                <item name="return_url" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ReturnUrlDataBuilder</item>
                <item name="client_ip" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ClientIPDataBuilder</item>
                <item name="description" xsi:type="string">Buckaroo\Magento2\Gateway\Request\DescriptionDataBuilder</item>
                <item name="additional_parameters" xsi:type="string">AdditionalParametersRefundDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Buckaroo Refund Command - Response Handler -->
    <virtualType name="RefundResponseHandler"  type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="response" xsi:type="string">Buckaroo\Magento2\Gateway\Response\RefundHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- END Buckaroo Refund Command -->

    <!-- END Buckaroo Commands infrastructure -->
    <!-- END Buckaroo Payment Provider Gateway -->

    <type name="Magento\Payment\Model\MethodList">
        <arguments>
            <argument name="additionalChecks" xsi:type="array">
                <item name="ip" xsi:type="string">ip</item>
            </argument>
        </arguments>
    </type>

    <type name="Magento\Payment\Model\Checks\SpecificationFactory">
        <arguments>
            <argument name="mapping" xsi:type="array">
                <item name="ip" xsi:type="object">Buckaroo\Magento2\Model\Checks\CanUseForIP</item>
            </argument>
        </arguments>
    </type>

    <!-- iDEAL Buckaroo using Payment Provider Gateway -->
    <virtualType name="IdealPaymentGatewayFacade" type="Buckaroo\Magento2\Model\Method\BuckarooAdapter">
        <arguments>
            <argument name="code" xsi:type="const">Buckaroo\Magento2\Model\ConfigProvider\Method\IdealGateway::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Buckaroo\Magento2\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">IdealPaymentGatewayValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">IdealValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">IdealPaymentGatewayCommandPool</argument>
            <argument name="usesRedirect" xsi:type="boolean">true</argument>
        </arguments>
    </virtualType>

    <!-- iDEAL Buckaroo Gateway Payment Provider valueHandlerPool -->
    <virtualType name="IdealPaymentGatewayValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">IdealPaymentGatewayConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="IdealPaymentGatewayConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\IdealGateway</argument>
        </arguments>
    </virtualType>

    <!-- Configuration reader -->
    <virtualType name="IdealPaymentGatewayConfig" type="Magento\Payment\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Buckaroo\Magento2\Model\ConfigProvider\Method\IdealGateway::CODE
            </argument>
        </arguments>
    </virtualType>

    <!-- iDEAL Buckaroo Gateway Payment Provider validatorPool -->
    <virtualType name="IdealValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">BuckarooCountryValidator</item>
                <item name="global" xsi:type="string">Buckaroo\Magento2\Gateway\Validator\IssuerValidator</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Buckaroo\Magento2\Gateway\Validator\IssuerValidator">
        <arguments>
            <argument name="config" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\IdealGateway</argument>
            <argument name="helper" xsi:type="object">Buckaroo\Magento2\Helper\Data</argument>
            <argument name="request" xsi:type="object">Magento\Framework\App\RequestInterface</argument>
        </arguments>
    </type>

    <virtualType name="BuckarooCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">IdealPaymentGatewayConfig</argument>
        </arguments>
    </virtualType>

    <!-- iDEAL Buckaroo Gateway Payment Provider commandPool -->
    <virtualType name="IdealPaymentGatewayCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="order" xsi:type="string">IdealOrderCommand</item>
                <item name="refund" xsi:type="string">IdealRefundCommand</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="IdealOrderCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">IdealSdkOrderRequest</argument>
            <argument name="transferFactory" xsi:type="object">Buckaroo\Magento2\Gateway\Http\SDKTransferFactory</argument>
            <argument name="client" xsi:type="object">Buckaroo\Magento2\Gateway\Http\Client\TransactionPay</argument>
            <argument name="handler" xsi:type="object">IdealAuthorizationHandler</argument>
            <argument name="validator" xsi:type="object">Buckaroo\Magento2\Gateway\Validator\ResponseCodeSDKValidator</argument>
            <argument name="errorMessageMapper" xsi:type="object">Buckaroo\Magento2\Gateway\ErrorMapper\VirtualErrorMessageMapper</argument>
        </arguments>
    </virtualType>

    <virtualType name="IdealRefundCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">IdealSdkRefundRequest</argument>
            <argument name="transferFactory" xsi:type="object">Buckaroo\Magento2\Gateway\Http\SDKTransferFactory</argument>
            <argument name="client" xsi:type="object">Buckaroo\Magento2\Gateway\Http\Client\TransactionRefund</argument>
            <argument name="handler" xsi:type="object">IdealRefundHandler</argument>
            <argument name="validator" xsi:type="object">Buckaroo\Magento2\Gateway\Validator\ResponseCodeSDKValidator</argument>
            <argument name="errorMessageMapper" xsi:type="object">Buckaroo\Magento2\Gateway\ErrorMapper\VirtualErrorMessageMapper</argument>
        </arguments>
    </virtualType>

    <virtualType name="IdealOrderRequest" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="order" xsi:type="string">Buckaroo\Magento2\Gateway\Request\OrderDataBuilder</item>
                <item name="services" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ServicesDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="IdealSdkOrderRequest" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="method" xsi:type="string">Buckaroo\Magento2\Gateway\Request\PaymentMethodDataBuilder</item>
                <item name="amount_debit" xsi:type="string">Buckaroo\Magento2\Gateway\Request\AmountDebitDataBuilder</item>
                <item name="issuer" xsi:type="string">Buckaroo\Magento2\Gateway\Request\IssuerDataBuilder</item>
                <item name="return_url" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ReturnUrlDataBuilder</item>
                <item name="invoice" xsi:type="string">Buckaroo\Magento2\Gateway\Request\InvoiceDataBuilder</item>
                <item name="client_ip" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ClientIPDataBuilder</item>
                <item name="description" xsi:type="string">Buckaroo\Magento2\Gateway\Request\DescriptionDataBuilder</item>
                <item name="additional_parameters" xsi:type="string">AdditionalParametersOrderDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="IdealSdkRefundRequest" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="method" xsi:type="string">Buckaroo\Magento2\Gateway\Request\PaymentMethodDataBuilder</item>
                <item name="invoice" xsi:type="string">Buckaroo\Magento2\Gateway\Request\InvoiceDataBuilder</item>
                <item name="original_transaction_key" xsi:type="string">Buckaroo\Magento2\Gateway\Request\OriginalTransactionKeyDataBuilder</item>
                <item name="amount_credit" xsi:type="string">Buckaroo\Magento2\Gateway\Request\AmountCreditDataBuilder</item>
                <item name="return_url" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ReturnUrlDataBuilder</item>
                <item name="client_ip" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ClientIPDataBuilder</item>
                <item name="description" xsi:type="string">Buckaroo\Magento2\Gateway\Request\DescriptionDataBuilder</item>
                <item name="additional_parameters" xsi:type="string">AdditionalParametersRefundDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>




    <!-- Response handlers -->
    <virtualType name="IdealAuthorizationHandler"  type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="txnid" xsi:type="string">Buckaroo\Magento2\Gateway\Response\TxnIdHandler</item>
                <item name="fraud" xsi:type="string">Buckaroo\Magento2\Gateway\Response\FraudHandler</item>
                <item name="response" xsi:type="string">Buckaroo\Magento2\Gateway\Response\OrderHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Response handlers -->
    <virtualType name="IdealRefundHandler"  type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="txnid" xsi:type="string">Buckaroo\Magento2\Gateway\Response\TxnIdHandler</item>
                <item name="fraud" xsi:type="string">Buckaroo\Magento2\Gateway\Response\FraudHandler</item>
                <item name="response" xsi:type="string">Buckaroo\Magento2\Gateway\Response\RefundHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- iDEAL Buckaroo using Payment Provider Gateway -->

    <!-- Message Mapper -->
    <virtualType name="Buckaroo\Magento2\Gateway\ErrorMapper\VirtualConfigReader" type="Magento\Payment\Gateway\ErrorMapper\VirtualConfigReader">
        <arguments>
            <argument name="fileName" xsi:type="string">buckaroo_error_mapping.xml</argument>
        </arguments>
    </virtualType>

    <virtualType name="Buckaroo\Magento2\Gateway\ErrorMapper\VirtualMappingData" type="Magento\Payment\Gateway\ErrorMapper\MappingData">
        <arguments>
            <argument name="reader" xsi:type="object">Buckaroo\Magento2\Gateway\ErrorMapper\VirtualConfigReader</argument>
            <argument name="cacheId" xsi:type="string">buckaroo_error_mapper</argument>
        </arguments>
    </virtualType>

    <virtualType name="Buckaroo\Magento2\Gateway\ErrorMapper\VirtualErrorMessageMapper" type="Magento\Payment\Gateway\ErrorMapper\ErrorMessageMapper">
        <arguments>
            <argument name="messageMapping" xsi:type="object">Buckaroo\Magento2\Gateway\ErrorMapper\VirtualMappingData</argument>
        </arguments>
    </virtualType>
    <!-- Message Mapper -->

    <!-- Payment Method: Klarna -->
    <!-- Klarna Payment Method Facade configuration -->
    <virtualType name="KlarnaFacade" type="Buckaroo\Magento2\Model\Method\BuckarooAdapter">
        <arguments>
            <argument name="code" xsi:type="const">Buckaroo\Magento2\Model\ConfigProvider\Method\Klarna::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Buckaroo\Magento2\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">KlarnaValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">KlarnaValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">KlarnaGatewayCommandPool</argument>
            <argument name="usesRedirect" xsi:type="boolean">true</argument>
        </arguments>
    </virtualType>

    <!-- Klarna Value handlers infrastructure -->
    <virtualType name="KlarnaValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">KlarnaConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="KlarnaConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Klarna</argument>
        </arguments>
    </virtualType>
    <!-- END Klarna Value handlers infrastructure -->

    <!-- Klarna validators infrastructure -->
    <virtualType name="KlarnaValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">KlarnaCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="KlarnaCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Klarna</argument>
        </arguments>
    </virtualType>
    <!-- END Klarna validators infrastructure -->

    <!-- Klarna Commands infrastructure -->
    <virtualType name="KlarnaGatewayCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="order" xsi:type="string">KlarnaOrderCommand</item>
                <item name="refund" xsi:type="string">BuckarooRefundCommand</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Klarna Order Command -->
    <virtualType name="KlarnaOrderCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">KlarnaOrderRequest</argument>
            <argument name="transferFactory" xsi:type="object">Buckaroo\Magento2\Gateway\Http\SDKTransferFactory</argument>
            <argument name="client" xsi:type="object">Buckaroo\Magento2\Gateway\Http\Client\TransactionPay</argument>
            <argument name="handler" xsi:type="object">OrderResponseHandler</argument>
            <argument name="validator" xsi:type="object">Buckaroo\Magento2\Gateway\Validator\ResponseCodeSDKValidator</argument>
            <argument name="errorMessageMapper" xsi:type="object">Buckaroo\Magento2\Gateway\ErrorMapper\VirtualErrorMessageMapper</argument>
        </arguments>
    </virtualType>

    <!-- Klarna Order Command - Request Builder -->
    <virtualType name="KlarnaOrderRequest" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="method" xsi:type="string">Buckaroo\Magento2\Gateway\Request\PaymentMethodDataBuilder</item>
                <item name="amount_debit" xsi:type="string">Buckaroo\Magento2\Gateway\Request\AmountDebitDataBuilder</item>
                <item name="invoice" xsi:type="string">Buckaroo\Magento2\Gateway\Request\InvoiceDataBuilder</item>
                <item name="return_url" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ReturnUrlDataBuilder</item>
                <item name="client_ip" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ClientIPDataBuilder</item>
                <item name="articles" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ArticlesDataBuilder</item>
                <item name="description" xsi:type="string">Buckaroo\Magento2\Gateway\Request\DescriptionDataBuilder</item>
                <item name="customer" xsi:type="string">CustomerDataBuilder</item>
                <item name="additional_parameters" xsi:type="string">AdditionalParametersPayDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="CustomerDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="shipping" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ShippingDataBuilder</item>
                <item name="billing" xsi:type="string">Buckaroo\Magento2\Gateway\Request\BillingDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- END Klarna Order Command -->
    <!-- END Klarna Commands infrastructure -->
    <!-- END Payment Method: Klarna -->

    <!-- Payment Method: KlarnaIn (Klarna Slice It) -->
    <!-- KlarnaIn Payment Method Facade configuration -->
    <virtualType name="KlarnaInFacade" type="KlarnaFacade">
        <arguments>
            <argument name="code" xsi:type="const">Buckaroo\Magento2\Model\ConfigProvider\Method\Klarnain::CODE</argument>
            <argument name="valueHandlerPool" xsi:type="object">KlarnaInValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">KlarnaInValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">KlarnaInGatewayCommandPool</argument>
        </arguments>
    </virtualType>

    <!-- KlarnaIn Value handlers infrastructure -->
    <virtualType name="KlarnaInValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">KlarnaInConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="KlarnaInConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Klarnain</argument>
        </arguments>
    </virtualType>
    <!-- END KlarnaIn Value handlers infrastructure -->

    <!-- KlarnaIn validators infrastructure -->
    <virtualType name="KlarnaInValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">KlarnaInCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="KlarnaInCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Klarnain</argument>
        </arguments>
    </virtualType>
    <!-- END KlarnaIn validators infrastructure -->

    <!-- KlarnaIn Commands infrastructure -->
    <virtualType name="KlarnaInGatewayCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="order" xsi:type="string">KlarnaInOrderCommand</item>
                <item name="refund" xsi:type="string">BuckarooRefundCommand</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- KlarnaIn Order Command -->
    <virtualType name="KlarnaInOrderCommand" type="KlarnaOrderCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">KlarnaInOrderRequest</argument>
            <argument name="client" xsi:type="object">Buckaroo\Magento2\Gateway\Http\Client\TransactionPayInInstallments</argument>
        </arguments>
    </virtualType>

    <!-- KlarnaIn Order Command - Request Builder -->
    <virtualType name="KlarnaInOrderRequest" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="klarna_order_request" xsi:type="string">KlarnaOrderRequest</item>
                <item name="additional_parameters" xsi:type="string">AdditionalParametersPayInInstallmentsDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- END KlarnaIn Order Command -->
    <!-- END KlarnaIn Commands infrastructure -->
    <!-- END Payment Method: KlarnaIn -->

    <!-- Payment Method: KlarnaKp -->
    <!-- KlarnaKp Payment Method Facade configuration -->
    <virtualType name="KlarnaKpFacade" type="Buckaroo\Magento2\Model\Method\BuckarooAdapter">
        <arguments>
            <argument name="code" xsi:type="const">Buckaroo\Magento2\Model\ConfigProvider\Method\Klarnakp::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Buckaroo\Magento2\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">KlarnaKpValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">KlarnaKpValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">KlarnaKpGatewayCommandPool</argument>
            <argument name="usesRedirect" xsi:type="boolean">true</argument>
        </arguments>
    </virtualType>
    <!-- KlarnaKp Value handlers infrastructure -->
    <virtualType name="KlarnaKpValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">KlarnaKpConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="KlarnaKpConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Klarnakp</argument>
        </arguments>
    </virtualType>
    <!-- END KlarnaKp Value handlers infrastructure -->

    <!-- KlarnaKp validators infrastructure -->
    <virtualType name="KlarnaKpValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">KlarnaKpCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="KlarnaKpCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Klarnakp</argument>
        </arguments>
    </virtualType>
    <!-- END KlarnaKp validators infrastructure -->

    <!-- KlarnaKp Commands infrastructure -->
    <virtualType name="KlarnaKpGatewayCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="authorize" xsi:type="string">KlarnaKpAuthorizeCommand</item>
                <item name="refund" xsi:type="string">BuckarooRefundCommand</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- KlarnaKp Authorize Command -->
    <virtualType name="KlarnaKpAuthorizeCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">KlarnaKpAuthorizeRequest</argument>
            <argument name="transferFactory" xsi:type="object">Buckaroo\Magento2\Gateway\Http\SDKTransferFactory</argument>
            <argument name="client" xsi:type="object">Buckaroo\Magento2\Gateway\Http\Client\TransactionReserve</argument>
            <argument name="handler" xsi:type="object">AuthorizeResponseHandler</argument>
            <argument name="validator" xsi:type="object">Buckaroo\Magento2\Gateway\Validator\ResponseCodeSDKValidator</argument>
            <argument name="errorMessageMapper" xsi:type="object">Buckaroo\Magento2\Gateway\ErrorMapper\VirtualErrorMessageMapper</argument>
        </arguments>
    </virtualType>
    <!-- KlarnaKp Authorize Command - Request Builder -->
    <virtualType name="KlarnaKpAuthorizeRequest" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="klarnakp_reserve_request" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ReserveDataBuilder</item>
                <item name="klarna_order_request" xsi:type="string">KlarnaOrderRequest</item>
                <item name="additional_parameters" xsi:type="string">AdditionalParametersReserveDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- KlarnaKp Authorize Command - Gateway Client -->
    <!-- KlarnaKp Authorize Command - Response Validator -->
    <!-- KlarnaKp Authorize Command - Response Handler -->
    <!-- KlarnaKp Authorize Command - Error Code Mapping -->
    <!-- END KlarnaKp Authorize Command -->

    <!-- KlarnaKp Refund Command -->
    <!-- KlarnaKp Refund Command - Request Builder -->
    <!-- KlarnaKp Refund Command - Response Handler -->
    <!-- END KlarnaKp Refund Command -->

    <!-- END KlarnaKp Commands infrastructure -->
    <!-- END Payment Method: KlarnaKp -->


    <!-- Payment Method: Alipay -->
    <!-- Alipay Payment Method Facade configuration -->
    <virtualType name="AlipayFacade" type="Buckaroo\Magento2\Model\Method\BuckarooAdapter">
        <arguments>
            <argument name="code" xsi:type="const">Buckaroo\Magento2\Model\ConfigProvider\Method\Alipay::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Buckaroo\Magento2\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">AlipayValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">AlipayValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">AlipayGatewayCommandPool</argument>
            <argument name="usesRedirect" xsi:type="boolean">true</argument>
        </arguments>
    </virtualType>
    <!-- Alipay Value handlers infrastructure -->
    <virtualType name="AlipayValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">AlipayConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="AlipayConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Alipay</argument>
        </arguments>
    </virtualType>
    <!-- END Alipay Value handlers infrastructure -->

    <!-- Alipay validators infrastructure -->
    <virtualType name="AlipayValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">AlipayCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="AlipayCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Alipay</argument>
        </arguments>
    </virtualType>
    <!-- END Alipay validators infrastructure -->

    <!-- Alipay Commands infrastructure -->
    <virtualType name="AlipayGatewayCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="order" xsi:type="string">AlipayOrderCommand</item>
                <item name="refund" xsi:type="string">BuckarooRefundCommand</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Alipay Order Command -->
    <virtualType name="AlipayOrderCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">AlipayOrderRequest</argument>
            <argument name="transferFactory" xsi:type="object">Buckaroo\Magento2\Gateway\Http\SDKTransferFactory</argument>
            <argument name="client" xsi:type="object">Buckaroo\Magento2\Gateway\Http\Client\TransactionPay</argument>
            <argument name="handler" xsi:type="object">OrderResponseHandler</argument>
            <argument name="validator" xsi:type="object">Buckaroo\Magento2\Gateway\Validator\ResponseCodeSDKValidator</argument>
            <argument name="errorMessageMapper" xsi:type="object">Buckaroo\Magento2\Gateway\ErrorMapper\VirtualErrorMessageMapper</argument>
        </arguments>
    </virtualType>
    <!-- Alipay Order Command - Request Builder -->
    <virtualType name="AlipayOrderRequest" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="method" xsi:type="string">Buckaroo\Magento2\Gateway\Request\PaymentMethodDataBuilder</item>
                <item name="amount_debit" xsi:type="string">Buckaroo\Magento2\Gateway\Request\AmountDebitDataBuilder</item>
                <item name="invoice" xsi:type="string">Buckaroo\Magento2\Gateway\Request\InvoiceDataBuilder</item>
                <item name="return_url" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ReturnUrlDataBuilder</item>
                <item name="client_ip" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ClientIPDataBuilder</item>
                <item name="use_mobile_view" xsi:type="string">Buckaroo\Magento2\Gateway\Request\UseMobileViewDataBuilder</item>
                <item name="additional_parameters" xsi:type="string">AdditionalParametersPayDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- END Alipay Order Command -->
    <!-- END Alipay Commands infrastructure -->
    <!-- END Payment Method: Alipay -->


    <!-- Payment Method: Giropay -->
    <!-- Giropay Payment Method Facade configuration -->
    <virtualType name="GiropayFacade" type="Buckaroo\Magento2\Model\Method\BuckarooAdapter">
        <arguments>
            <argument name="code" xsi:type="const">Buckaroo\Magento2\Model\ConfigProvider\Method\Giropay::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Buckaroo\Magento2\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">GiropayValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">GiropayValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">GiropayGatewayCommandPool</argument>
            <argument name="usesRedirect" xsi:type="boolean">true</argument>
        </arguments>
    </virtualType>
    <!-- Giropay Value handlers infrastructure -->
    <virtualType name="GiropayValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">GiropayConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="GiropayConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Giropay</argument>
        </arguments>
    </virtualType>
    <!-- END Giropay Value handlers infrastructure -->

    <!-- Giropay validators infrastructure -->
    <virtualType name="GiropayValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">GiropayCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="GiropayCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Giropay</argument>
        </arguments>
    </virtualType>
    <!-- END Giropay validators infrastructure -->

    <!-- Giropay Commands infrastructure -->
    <virtualType name="GiropayGatewayCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="order" xsi:type="string">GiropayOrderCommand</item>
                <item name="refund" xsi:type="string">BuckarooRefundCommand</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Giropay Order Command -->
    <virtualType name="GiropayOrderCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">GiropayOrderRequest</argument>
            <argument name="transferFactory" xsi:type="object">Buckaroo\Magento2\Gateway\Http\SDKTransferFactory</argument>
            <argument name="client" xsi:type="object">Buckaroo\Magento2\Gateway\Http\Client\TransactionPay</argument>
            <argument name="handler" xsi:type="object">OrderResponseHandler</argument>
            <argument name="validator" xsi:type="object">Buckaroo\Magento2\Gateway\Validator\ResponseCodeSDKValidator</argument>
            <argument name="errorMessageMapper" xsi:type="object">Buckaroo\Magento2\Gateway\ErrorMapper\VirtualErrorMessageMapper</argument>
        </arguments>
    </virtualType>
    <!-- Giropay Order Command - Request Builder -->
    <virtualType name="GiropayOrderRequest" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="method" xsi:type="string">Buckaroo\Magento2\Gateway\Request\PaymentMethodDataBuilder</item>
                <item name="amount_debit" xsi:type="string">Buckaroo\Magento2\Gateway\Request\AmountDebitDataBuilder</item>
                <item name="invoice" xsi:type="string">Buckaroo\Magento2\Gateway\Request\InvoiceDataBuilder</item>
                <item name="return_url" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ReturnUrlDataBuilder</item>
                <item name="client_ip" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ClientIPDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- END Giropay Order Command -->
    <!-- END Giropay Commands infrastructure -->
    <!-- END Payment Method: Giropay -->

    <!-- Payment Method: Trustly -->
    <!-- Trustly Payment Method Facade configuration -->
    <virtualType name="TrustlyFacade" type="Buckaroo\Magento2\Model\Method\BuckarooAdapter">
        <arguments>
            <argument name="code" xsi:type="const">Buckaroo\Magento2\Model\ConfigProvider\Method\Trustly::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Buckaroo\Magento2\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">TrustlyValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">TrustlyValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">TrustlyGatewayCommandPool</argument>
            <argument name="usesRedirect" xsi:type="boolean">true</argument>
        </arguments>
    </virtualType>
    <!-- Trustly Value handlers infrastructure -->
    <virtualType name="TrustlyValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">TrustlyConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="TrustlyConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Trustly</argument>
        </arguments>
    </virtualType>
    <!-- END Trustly Value handlers infrastructure -->

    <!-- Trustly validators infrastructure -->
    <virtualType name="TrustlyValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">TrustlyCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="TrustlyCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Trustly</argument>
        </arguments>
    </virtualType>
    <!-- END Trustly validators infrastructure -->

    <!-- Trustly Commands infrastructure -->
    <virtualType name="TrustlyGatewayCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="order" xsi:type="string">TrustlyOrderCommand</item>
                <item name="refund" xsi:type="string">BuckarooRefundCommand</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Trustly Order Command -->
    <virtualType name="TrustlyOrderCommand" type="BuckarooOrderCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TrustlyOrderRequest</argument>
        </arguments>
    </virtualType>
    <!-- Trustly Order Command - Request Builder -->
    <virtualType name="TrustlyOrderRequest" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="order_request" xsi:type="string">BuckarooOrderRequest</item>
                <item name="country" xsi:type="string">Buckaroo\Magento2\Gateway\Request\CountryDataBuilder</item>
                <item name="customer_name" xsi:type="string">Buckaroo\Magento2\Gateway\Request\CustomerNameDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- END Trustly Order Command -->
    <!-- END Trustly Commands infrastructure -->
    <!-- END Payment Method: Trustly -->

    <!-- Payment Method: Przelewy24 -->
    <!-- Przelewy24 Payment Method Facade configuration -->
    <virtualType name="Przelewy24Facade" type="Buckaroo\Magento2\Model\Method\BuckarooAdapter">
        <arguments>
            <argument name="code" xsi:type="const">Buckaroo\Magento2\Model\ConfigProvider\Method\P24::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Buckaroo\Magento2\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">Przelewy24ValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">Przelewy24ValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">Przelewy24GatewayCommandPool</argument>
            <argument name="usesRedirect" xsi:type="boolean">true</argument>
        </arguments>
    </virtualType>
    <!-- Przelewy24 Value handlers infrastructure -->
    <virtualType name="Przelewy24ValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">Przelewy24ConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="Przelewy24ConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\P24</argument>
        </arguments>
    </virtualType>
    <!-- END Przelewy24 Value handlers infrastructure -->

    <!-- Przelewy24 validators infrastructure -->
    <virtualType name="Przelewy24ValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">Przelewy24CountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Przelewy24CountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\P24</argument>
        </arguments>
    </virtualType>
    <!-- END Przelewy24 validators infrastructure -->

    <!-- Przelewy24 Commands infrastructure -->
    <virtualType name="Przelewy24GatewayCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="order" xsi:type="string">Przelewy24OrderCommand</item>
                <item name="refund" xsi:type="string">BuckarooRefundCommand</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Przelewy24 Order Command -->
    <virtualType name="Przelewy24OrderCommand" type="BuckarooOrderCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Przelewy24OrderRequest</argument>
        </arguments>
    </virtualType>
    <!-- Przelewy24 Order Command - Request Builder -->
    <virtualType name="Przelewy24OrderRequest" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="order_request" xsi:type="string">BuckarooOrderRequest</item>
                <item name="email" xsi:type="string">Buckaroo\Magento2\Gateway\Request\EmailDataBuilder</item>
                <item name="customer_name" xsi:type="string">Buckaroo\Magento2\Gateway\Request\CustomerNameDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- END Przelewy24 Order Command -->
    <!-- END Przelewy24 Commands infrastructure -->
    <!-- END Payment Method: Przelewy24 -->


    <!-- Payment Method: Belfius -->
    <!-- Belfius Payment Method Facade configuration -->
    <virtualType name="BelfiusFacade" type="Buckaroo\Magento2\Model\Method\BuckarooAdapter">
        <arguments>
            <argument name="code" xsi:type="const">Buckaroo\Magento2\Model\ConfigProvider\Method\Belfius::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Buckaroo\Magento2\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">BelfiusValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">BelfiusValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">BelfiusGatewayCommandPool</argument>
            <argument name="usesRedirect" xsi:type="boolean">true</argument>
        </arguments>
    </virtualType>
    <!-- Belfius Value handlers infrastructure -->
    <virtualType name="BelfiusValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">BelfiusConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="BelfiusConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Belfius</argument>
        </arguments>
    </virtualType>
    <!-- END Belfius Value handlers infrastructure -->

    <!-- Belfius validators infrastructure -->
    <virtualType name="BelfiusValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">BelfiusCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="BelfiusCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Belfius</argument>
        </arguments>
    </virtualType>
    <!-- END Belfius validators infrastructure -->

    <!-- Belfius Commands infrastructure -->
    <virtualType name="BelfiusGatewayCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="order" xsi:type="string">BuckarooOrderCommand</item>
                <item name="refund" xsi:type="string">BuckarooRefundCommand</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- END Belfius Commands infrastructure -->
    <!-- END Payment Method: Belfius -->

     <!-- Payment Method: Capayable -->
    <!-- Capayable Payment Method Facade configuration -->
    <virtualType name="CapayableFacade" type="Buckaroo\Magento2\Model\Method\BuckarooAdapter">
        <arguments>
            <argument name="code" xsi:type="const">Buckaroo\Magento2\Model\ConfigProvider\Method\CapayableIn3::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Buckaroo\Magento2\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">CapayableValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">CapayableValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">CapayableGatewayCommandPool</argument>
            <argument name="usesRedirect" xsi:type="boolean">true</argument>
        </arguments>
    </virtualType>
    <!-- Capayable Value handlers infrastructure -->
    <virtualType name="CapayableValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">CapayableConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="CapayableConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\CapayableIn3</argument>
        </arguments>
    </virtualType>
    <!-- END Capayable Value handlers infrastructure -->

    <!-- Capayable validators infrastructure -->
    <virtualType name="CapayableValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">CapayableCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="CapayableCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\CapayableIn3</argument>
        </arguments>
    </virtualType>
    <!-- END Capayable validators infrastructure -->

    <!-- Capayable Commands infrastructure -->
    <virtualType name="CapayableGatewayCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="order" xsi:type="string">CapayableOrderCommand</item>
                <item name="refund" xsi:type="string">BuckarooRefundCommand</item>
            </argument>
        </arguments>
    </virtualType>

     <!-- Capayable Order Command -->
    <virtualType name="CapayableOrderCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">CapayableOrderRequest</argument>
            <argument name="transferFactory" xsi:type="object">Buckaroo\Magento2\Gateway\Http\SDKTransferFactory</argument>
            <argument name="client" xsi:type="object">Buckaroo\Magento2\Gateway\Http\Client\TransactionPay</argument>
            <argument name="handler" xsi:type="object">OrderResponseHandler</argument>
            <argument name="validator" xsi:type="object">Buckaroo\Magento2\Gateway\Validator\ResponseCodeSDKValidator</argument>
            <argument name="errorMessageMapper" xsi:type="object">Buckaroo\Magento2\Gateway\ErrorMapper\VirtualErrorMessageMapper</argument>
        </arguments>
    </virtualType>
    <!-- Capayable Order Command - Request Builder -->
    <virtualType name="CapayableOrderRequest" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="method" xsi:type="string">Buckaroo\Magento2\Gateway\Request\PaymentMethodDataBuilder</item>
                <item name="amount_debit" xsi:type="string">Buckaroo\Magento2\Gateway\Request\AmountDebitDataBuilder</item>
                <item name="invoice" xsi:type="string">Buckaroo\Magento2\Gateway\Request\InvoiceDataBuilder</item>
                <item name="return_url" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ReturnUrlDataBuilder</item>
                <item name="client_ip" xsi:type="string">Buckaroo\Magento2\Gateway\Request\ClientIPDataBuilder</item>
                <item name="additional_parameters" xsi:type="string">AdditionalParametersPayInInstallmentsDataBuilder</item>
                <item name="email" xsi:type="string">Buckaroo\Magento2\Gateway\Request\EmailDataBuilder</item>
                <item name="phone" xsi:type="string">CapayablePhone</item>
                <item name="customer_type" xsi:type="string">Buckaroo\Magento2\Gateway\Request\Capayable\Builder\CustomerType</item>
                <item name="invoice_date" xsi:type="string">Buckaroo\Magento2\Gateway\Request\Capayable\Builder\InvoiceDate</item>
                <item name="articles" xsi:type="string">Buckaroo\Magento2\Gateway\Request\Capayable\Builder\Articles</item>
                <item name="customer" xsi:type="string">Buckaroo\Magento2\Gateway\Request\Capayable\Builder\Customer</item>
                <item name="address" xsi:type="string">Buckaroo\Magento2\Gateway\Request\Capayable\Builder\Address</item>
                <item name="sub_totals" xsi:type="string">Buckaroo\Magento2\Gateway\Request\Capayable\Builder\SubTotals</item>

            </argument>
        </arguments>
    </virtualType>
    <virtualType name="CapayablePhone" type="Buckaroo\Magento2\Gateway\Request\Capayable\Builder\Phone">
        <arguments>
            <argument name="phoneFormatter" xsi:type="object">Buckaroo\Magento2\Service\Formatter\Address\PhoneFormatter</argument>
        </arguments>
    </virtualType>
    <!-- END Capayable Order Command -->
    <!-- END Capayable Commands infrastructure -->
    <!-- END Payment Method: Capayable -->

    <!-- Payment Method: Eps -->
    <!-- Eps Payment Method Facade configuration -->
    <virtualType name="EpsFacade" type="Buckaroo\Magento2\Model\Method\BuckarooAdapter">
        <arguments>
            <argument name="code" xsi:type="const">Buckaroo\Magento2\Model\ConfigProvider\Method\Eps::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Buckaroo\Magento2\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">EpsValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">EpsValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">BuckarooGatewayCommandPool</argument>
            <argument name="usesRedirect" xsi:type="boolean">false</argument>
        </arguments>
    </virtualType>
    <!-- Eps Value handlers infrastructure -->
    <virtualType name="EpsValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">EpsConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="EpsConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Eps</argument>
        </arguments>
    </virtualType>
    <!-- END Eps Value handlers infrastructure -->

    <!-- Eps validators infrastructure -->
    <virtualType name="EpsValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">EpsCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="EpsCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Eps</argument>
        </arguments>
    </virtualType>
    <!-- END Eps validators infrastructure -->

    <!-- END Eps Commands infrastructure -->
    <!-- END Payment Method: Eps -->

    <!-- Payment Method: Kbc -->
    <!-- Kbc Payment Method Facade configuration -->
    <virtualType name="KbcFacade" type="Buckaroo\Magento2\Model\Method\BuckarooAdapter">
        <arguments>
            <argument name="code" xsi:type="const">Buckaroo\Magento2\Model\ConfigProvider\Method\Kbc::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Buckaroo\Magento2\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">KbcValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">KbcValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">BuckarooGatewayCommandPool</argument>
            <argument name="usesRedirect" xsi:type="boolean">false</argument>
        </arguments>
    </virtualType>
    <!-- Kbc Value handlers infrastructure -->
    <virtualType name="KbcValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">KbcConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="KbcConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Kbc</argument>
        </arguments>
    </virtualType>
    <!-- END Kbc Value handlers infrastructure -->

    <!-- Kbc validators infrastructure -->
    <virtualType name="KbcValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">KbcCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="KbcCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">Buckaroo\Magento2\Model\ConfigProvider\Method\Kbc</argument>
        </arguments>
    </virtualType>
    <!-- END Kbc validators infrastructure -->

    <!-- END Kbc Commands infrastructure -->
    <!-- END Payment Method: Kbc -->
</config>
